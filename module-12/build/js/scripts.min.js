"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}var template=document.querySelector("#card").innerHTML.trim(),errTemplate=document.querySelector("#err").innerHTML.trim(),cardList=document.querySelector(".js-result"),btn=document.querySelector(".js-submit"),input=document.querySelector(".url"),errorContainer=document.querySelector(".err-Container"),preloader=document.querySelector(".banter-loader"),parsedItem=null,err={error:null},pattern=/^(https?:\/\/)?(www\.)?[a-zA-Z0-9-]{3,25}\.(([a-z]{2,4})\.)?([a-z]{2,4})(\/)?$/,localStorageKeys=Object.keys(localStorage),compileCardTemplate=function(e,r){var t=Handlebars.compile(r)(e);cardList.insertAdjacentHTML("afterbegin",t)},errorCompileTemplate=function(e,r,t){var o=Handlebars.compile(r);e.error=t;var a=o(e);errorContainer.innerHTML=a},removeHandler=function(e){var r=document.querySelector(".remove");r.addEventListener("click",function(){localStorage.removeItem(e),r.parentElement.remove(),errorCompileTemplate(err,errTemplate,"Закладка удалена")})},preloaderToogle=function(){return preloader.classList.toggle("show")},isValidInput=function(){return!!pattern.test(input.value)},onPageLoadedList=function(){localStorageKeys.forEach(function(e){parsedItem=JSON.parse(localStorage.getItem(e)),compileCardTemplate(parsedItem,template),removeHandler(parsedItem.title)})};onPageLoadedList();var fetchDataProcessing=function(e){if((localStorageKeys=[].concat(_toConsumableArray(Object.keys(localStorage)))).includes(e.title))return preloaderToogle(),errorCompileTemplate(err,errTemplate,"Такая закладка уже есть");compileCardTemplate(e,template),removeHandler(e.title),localStorage.setItem(e.title,JSON.stringify(e)),preloaderToogle()},fetchPromise=function(e){return e.preventDefault(),preloaderToogle(),isValidInput()?fetch("https://api.linkpreview.net/?key=5bb4b458291ae628454d202cf0a8b6e7f2a62a1c36d46&q="+input.value).then(function(e){if(e.ok)return e.json();errorCompileTemplate(err,errTemplate,"Ошибка Запроса"),preloaderToogle()}).then(fetchDataProcessing).catch(function(e){return console.log("ERROR",e)}):(errorCompileTemplate(err,errTemplate,"Ошибка Ввода"),void preloaderToogle())};btn.addEventListener("click",fetchPromise);