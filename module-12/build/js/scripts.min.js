"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}var template=document.querySelector("#card").innerHTML.trim(),errTemplate=document.querySelector("#err").innerHTML.trim(),cardList=document.querySelector(".js-result"),btn=document.querySelector(".js-submit"),input=document.querySelector(".url"),errorContainer=document.querySelector(".err-Container"),preloader=document.querySelector(".banter-loader"),parsedItem=null,err={error:null},API_KEY="5bb4b458291ae628454d202cf0a8b6e7f2a62a1c36d46&q",pattern=/^(https?:\/\/)?(www\.)?[a-zA-Z0-9-]{3,25}\.(([a-z]{2,4})\.)?([a-z]{2,4})(\/)?$/,localStorageKeys=Object.keys(localStorage),fetchPromise=function(e){return e.preventDefault(),preloaderToogle(),isValidInput()?fetch("https://api.linkpreview.net/?key="+API_KEY+"&q="+input.value).then(fetchResponseHandler).then(fetchDataProcessing).catch(function(e){return console.log("ERROR",e)}):(errorCompileTemplate(err,errTemplate,"Ошибка Ввода"),void preloaderToogle())};function fetchResponseHandler(e){if(e.ok)return e.json();errorCompileTemplate(err,errTemplate,"Ошибка Запроса"),preloaderToogle()}function compileCardTemplate(e,r){var t=Handlebars.compile(r)(e);cardList.insertAdjacentHTML("afterbegin",t)}function errorCompileTemplate(e,r,t){var o=Handlebars.compile(r);e.error=t;var a=o(e);errorContainer.innerHTML=a}function removeHandler(e){var r=e.target;"remove"===r.className&&(r.parentElement.remove(),errorCompileTemplate(err,errTemplate,"Закладка удалена"),localStorage.removeItem(r.nextSibling.textContent))}function preloaderToogle(){preloader.classList.toggle("show")}function isValidInput(){return!!pattern.test(input.value)}function onPageLoadedList(){localStorageKeys.forEach(function(e){compileCardTemplate(parsedItem=JSON.parse(localStorage.getItem(e)),template)})}function fetchDataProcessing(e){if((localStorageKeys=[].concat(_toConsumableArray(Object.keys(localStorage)))).includes(e.title))return preloaderToogle(),errorCompileTemplate(err,errTemplate,"Такая закладка уже есть");compileCardTemplate(e,template),localStorage.setItem(e.title,JSON.stringify(e)),preloaderToogle()}onPageLoadedList(),btn.addEventListener("click",fetchPromise),document.body.addEventListener("click",removeHandler);